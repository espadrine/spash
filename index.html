<!doctype html><meta charset=utf-8><title> Spacetime Locator </title>
<style>
html { max-width: 12cm; margin: auto; }
.centered { text-align: center; font-weight: bold; font-family: monospace; }
.logo { position: relative; top: 5px; }
#spashNode { font-size: 3em; }
</style>
<h1> Spash: Spacetime Locator </h1>

<p class=centered>
  <a href='https://github.com/espadrine/spash'>
  <svg class=logo width="20" height="20" viewBox="12 12 40 40">
  <path d="M32,13.4c-10.5,0-19,8.5-19,19c0,8.4,5.5,15.5,13,18c1,0.2,1.3-0.4,1.3-0.9c0-0.5,0-1.7,0-3.2 c-5.3,1.1-6.4-2.6-6.4-2.6C20,41.6,18.8,41,18.8,41c-1.7-1.2,0.1-1.1,0.1-1.1c1.9,0.1,2.9,2,2.9,2c1.7,2.9,4.5,2.1,5.5,1.6 c0.2-1.2,0.7-2.1,1.2-2.6c-4.2-0.5-8.7-2.1-8.7-9.4c0-2.1,0.7-3.7,2-5.1c-0.2-0.5-0.8-2.4,0.2-5c0,0,1.6-0.5,5.2,2 c1.5-0.4,3.1-0.7,4.8-0.7c1.6,0,3.3,0.2,4.7,0.7c3.6-2.4,5.2-2,5.2-2c1,2.6,0.4,4.6,0.2,5c1.2,1.3,2,3,2,5.1c0,7.3-4.5,8.9-8.7,9.4 c0.7,0.6,1.3,1.7,1.3,3.5c0,2.6,0,4.6,0,5.2c0,0.5,0.4,1.1,1.3,0.9c7.5-2.6,13-9.7,13-18.1C51,21.9,42.5,13.4,32,13.4z"/>
  </svg></a>
  <code class=selectable>npm install spash</code>
</p>
<p>
  Every day, humanity goes more vertical. Petty constraints like gravity are
  defied by <em>planes, kilometric skyscrapers, ambitious space programs</em>.
  <a href="http://iss.astroviewer.net">The ISS</a> peacefully maintains
  our orbital presence on the planet, and Elon Musk is already planning
  <a href="https://en.wikipedia.org/wiki/Interplanetary_Transport_System">
    a Martian settlement</a>.
</p>
<p>
  Your place in the universe gets more important by the second. Here is its
  identifier:
</p>
<section class=centered>
  <output id=spashNode>E.ek0uvhuQQ1q</output><br>
  <input type=button id=addDigitNode value='+'>
  <input type=button id=rmDigitNode value='-'>
  <input type=button id=editNode value='Edit'>
  <label><input type=checkbox id=showTimeNode> Show time</label>
</section>
<p id=geolocNode></p>
<p id=precisionNode></p>
<p id=noGeolocNode>
  Your device does not allow access to geolocation data. Using a default location.
</p>
<p id=warningsNode></p>
<footer>
  <p>
    Built by <a href=https://twitter.com/espadrine>Thaddée Tyl.</a>
    Full <a href=https://github.com/espadrine/spash/blob/master/Readme.md>
      specification</a>.
  </p>
</footer>

<script src=./spash.js></script>
<script>
  var geoloc;
  var showTimeHash = false;
  var digits = 11;
  var setGeoloc = function(geo) {
    geoloc = geo;
    var sh = spash.encode(geo, digits, 6);
    var hash = sh.iau + '.' + sh.geolocHash;
    if (showTimeHash) { hash += '.' + sh.timeHash; }
    spashNode.value = hash;
    showGeoloc();
    accuracyWarnings(sh, geo);
  };
  var gotGeoloc = function(geo) {
    noGeolocNode.style.display = 'none';
    setGeoloc(geo);
  };
  var noGeolocWarning = function() {
    noGeolocNode.style.display = 'block';
    var defaultGeo = {
      coords: {
        latitude: 51.5221656,
        longitude: -0.1086239,
        altitude: 22.725,
        accuracy: 2,
        altitudeAccuracy: 1e-9,
      },
      timestamp: Date.now(),
    };
    setGeoloc(defaultGeo);
  };
  navigator.geolocation.getCurrentPosition(gotGeoloc, noGeolocWarning, {
    enableHighAccuracy: true,
    timeout: 25000,
    maximumAge: 0
  });

  var showGeoloc = function() {
    var values = [
      'Latitude: ' + geoloc.coords.latitude + '°',
      'Longitude: ' + geoloc.coords.longitude + '°',
      'Altitude: ' + geoloc.coords.altitude + ' metres',
    ];
    if (showTimeHash) {
      values.push('Time: ' + new Date(geoloc.timestamp).toISOString());
    }
    geolocNode.innerHTML = values.join('<br>');
  };

  var accuracyWarnings = function(spash, geo) {
    var accuracies = [
      '± ' + spash.earthLatError + ' metres (latitude)',
      '± ' + spash.earthLongError + ' metres (longitude)',
      '± ' + spash.altError + ' metres (altitude)',
    ];
    if (showTimeHash) {
      accuracies.push('± ' + spash.timeError + ' seconds (time)');
    }
    precisionNode.innerHTML = accuracies.join('<br>');

    var geoAccuracy = geo.coords.accuracy || Infinity;  // meters
    var altAccuracy = (geo.coords.altitudeAccuracy) || Infinity;
    var warn = [];
    if (geoAccuracy > spash.earthLongError ||
        geoAccuracy > spash.earthLatError) {
      warn.push('Geographic coordinates are not accurate enough for this level of precision.');
    }
    if (geo.coords.altitudeAccuracy === null) {
      warn.push('Altitude measurement unavailable; using sea level.');
    } else if (altAccuracy > spash.altError) {
      warn.push('Altitude measurement is not accurate enough for this level of precision.');
    }

    warningsNode.innerHTML = warn.join('<br>');
  };

  var addDigit = function(event) {
    digits++;
    setGeoloc(geoloc);
  };
  var rmDigit = function(event) {
    if (digits <= 0) { return; }
    digits--;
    setGeoloc(geoloc);
  };
  var edit = function(event) {
    var newSpash = prompt('Enter a spash.');
    setGeoloc(spash.decode(newSpash));
  };
  var showTimeChanged = function(event) {
    showTimeHash = event.target.checked;
    setGeoloc(geoloc);
  };
  addDigitNode.addEventListener('click', addDigit);
  rmDigitNode.addEventListener('click', rmDigit);
  editNode.addEventListener('click', edit);
  showTimeNode.addEventListener('change', showTimeChanged);
</script>
